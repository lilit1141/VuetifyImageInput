!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue-range-slider"),require("vueclaw")):"function"==typeof define&&define.amd?define(["vue-range-slider","vueclaw"],e):(t=t||self).VuetifyImageInput=e(t.RangeSlider,t.VueClaw)}(this,(function(t,e){"use strict";function i(){}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n={props:{disabled:{type:Boolean,default:!1}},data:function(){return{cancel:i,dragging:!1,error:null,failed:!1,file:null,loaded:!1,loading:!1,progress:0,result:null}},computed:{on:function(){return this.disabled?{}:{click:this.onClick,dragenter:this.onDragEnter,dragleave:this.onDragLeave,dragover:this.onDragOver,drop:this.onDrop}}},methods:{load:function(t){var e,n=this;(e=function(){n.cancel();var e=new FileReader,i=new Promise((function(i,a){e.addEventListener("progress",(function(e){var i=e.loaded;n.progress=i,n.$emit("progress",{file:t,loaded:i})})),e.addEventListener("load",(function(){var a=e.result;Object.assign(n,{loaded:!0,result:a}),n.$emit("load",{file:t,result:a}),i()})),e.addEventListener("abort",(function(){n.$emit("cancel",{file:t}),i()})),e.addEventListener("error",a)}));return e.readAsDataURL(t),Object.assign(n,{cancel:function(){1===e.readyState&&e.abort()},error:null,failed:!1,file:t,loaded:!1,loading:!0,progress:0,result:null}),i},new Promise((function(t){t(e())}))).catch((function(e){Object.assign(n,{error:e,failed:!0}),n.$emit("error",{error:e,file:t})})).finally((function(){Object.assign(n,{cancel:i,loading:!1})}))},onChange:function(t){t.preventDefault();var e=t.target.files;e&&e.length&&this.load(e[0])},onClick:function(t){t.preventDefault();var e=document.createElement("input");e.setAttribute("type","file");var i=this.onChange;e.addEventListener("change",i),e.click()},onDragEnter:function(t){t.preventDefault(),this.dragging=!0},onDragLeave:function(t){t.preventDefault(),this.dragging=!1},onDragOver:function(t){t.preventDefault()},onDrop:function(t){t.preventDefault(),this.dragging=!1;var e=t.dataTransfer.files;e&&e.length&&this.load(e[0])}},render:function(){var t=this,e=t.$scopedSlots,i=t.cancel,n=t.dragging,a=t.error,r=t.failed,o=t.file,l=t.loaded,s=t.loading,c=t.on,d=t.progress,u=t.result;return e.default({cancel:i,dragging:n,error:a,failed:r,file:o,loaded:l,loading:s,on:c,progress:d,result:u})}};var a={functional:!0,render:function(t,e){var i=e.data,a=e.listeners,r=e.parent,o=r.disabled,l=r.errorIcon,s=r.errorIconStyle,c=r.successIcon,d=r.successIconStyle,u=r.uploadIcon,g=r.uploadIconStyle,p=a.load,h=i.style;return t(n,{style:h,props:{disabled:o},scopedSlots:{default:function(e){e.dragging;var i=e.failed,n=e.file,a=e.loaded,r=e.loading,p=e.on,h=e.progress;return t("div",{style:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",width:"100%"},props:{disabled:o},on:p},[function(){if(r){var e,p=h/n.size*100;return p&&(e=Math.round(p)+"%"),t("sui-icon",{props:{name:"progress-circular"}},e)}var f,y;return a?(f=d,y=c):i?(f=s,y=l):(f=g,y=u),t("sui-icon",{style:f,class:"icon "+y,props:{disabled:o,name:y}},y)}()])}},on:{load:function(t){var e=t.file,i=t.result;p({file:e,base64:i})}}})}};function r(t,e,i){return Math.min(Math.max(t,e),i)}var o={computedMaxCroppingLeft:function(){return Math.max(0,this.scaledRotatedInternalImageWidthDifference)},computedMaxCroppingTop:function(){return Math.max(0,this.scaledRotatedInternalImageHeightDifference)},computedMaxScaling:function(){return Math.max(this.imageMaxScaling,this.computedMinScaling)},computedMinCroppingLeft:function(){return Math.min(0,this.scaledRotatedInternalImageWidthDifference)},computedMinCroppingTop:function(){return Math.min(0,this.scaledRotatedInternalImageHeightDifference)},computedMinScaling:function(){switch(this.imageMinScaling){case"cover":return Math.max(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight);case"contain":return Math.min(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight)}return 0},croppingLeft:{get:function(){return Math.round(r(this.scaledRotatedInternalImageWidthDifference*this.dirtyOriginLeft,this.computedMinCroppingLeft,this.computedMaxCroppingLeft))},set:function(t){var e=this.scaledRotatedInternalImageWidthDifference;this.dirtyOriginLeft=e?t/e:.5}},croppingTop:{get:function(){return Math.round(r(this.scaledRotatedInternalImageHeightDifference*this.dirtyOriginTop,this.computedMinCroppingTop,this.computedMaxCroppingTop))},set:function(t){var e=this.scaledRotatedInternalImageHeightDifference;this.dirtyOriginTop=e?t/e:.5}},relativeRotatedInternalImageHeight:function(){return this.imageHeight/this.rotatedInternalImageHeight},relativeRotatedInternalImageWidth:function(){return this.imageWidth/this.rotatedInternalImageWidth},rotatedInternalImageHeight:function(){return this.rotated?this.internalImageWidth:this.internalImageHeight},rotatedInternalImageWidth:function(){return this.rotated?this.internalImageHeight:this.internalImageWidth},scaledRotatedInternalImageHeight:function(){return Math.round(this.scaling*this.rotatedInternalImageHeight)},scaledRotatedInternalImageHeightDifference:function(){return this.imageHeight-this.scaledRotatedInternalImageHeight},scaledRotatedInternalImageWidth:function(){return Math.round(this.scaling*this.rotatedInternalImageWidth)},scaledRotatedInternalImageWidthDifference:function(){return this.imageWidth-this.scaledRotatedInternalImageWidth},scaling:{get:function(){return r(this.dirtyScaling,this.computedMinScaling,this.computedMaxScaling)},set:function(t){this.dirtyScaling=t}},updateImageData:function(){var t=this,e=this,i=e.croppingLeft,n=e.croppingTop,a=e.debounce,r=e.flippedHorizontally,o=e.flippedVertically,l=e.imageBackgroundColor,s=e.imageFormat,c=e.imageHeight,d=e.imageQuality,u=e.imageWidth,g=e.internalImageData,p=e.internalImageHeight,h=e.internalImageWidth,f=e.rotated,y=e.scaling;return setTimeout((function(){var e;if(g){var a=new Image;a.src=g;var m=document.createElement("canvas"),I=m.getContext("2d");m.width=u,m.height=c,l&&(I.fillStyle=l,I.fillRect(0,0,u,c)),I.translate(i,n),I.scale(y,y),f&&(I.translate(p,0),I.rotate(Math.PI/2)),r&&(I.translate(h,0),I.scale(-1,1)),o&&(I.translate(0,p),I.scale(1,-1)),I.drawImage(a,0,0),r&&(I.translate(u,0),I.scale(-1,1)),o&&(I.translate(0,c),I.scale(1,-1)),e=m.toDataURL("image/"+s,d)}else e=null;t.imageData=e}),a)}},l="VImageInput";var s={type:Boolean,default:!1},c={type:Boolean,default:!1},d={type:Boolean,default:!1},u={type:Boolean,default:!1},g={type:Boolean,default:!1},p={type:Boolean,default:!1};var h={name:l,components:{MyActionButton:{functional:!0,render:function(t,e){var i=e.listeners,n=e.parent,a=e.props;return t("sui-button",{class:"ma-1",props:{disabled:n.disabled,flat:!0,icon:!0},on:i},[t("sui-icon",{style:a.iconStyle,class:"icon "+a.icon,props:{name:a.icon}},a.icon)])}},MyClearButton:{functional:!0,render:function(t,e){var i=e.parent;return t("MyActionButton",{props:{icon:i.clearIcon,iconStyle:i.clearIconStyle},on:{click:i.clear}})}},MyFileUpload:a,MyFlipHorizontallyButton:{functional:!0,render:function(t,e){var i=e.parent;return t("MyActionButton",{props:{icon:i.flipHorizontallyIcon,iconStyle:i.flipHorizontallyIconStyle},on:{click:i.flipHorizontally}})}},MyFlipVerticallyButton:{functional:!0,render:function(t,e){var i=e.parent;return t("MyActionButton",{props:{icon:i.flipVerticallyIcon,iconStyle:i.flipVerticallyIconStyle},on:{click:i.flipVertically}})}},MyRotateClockwiseButton:{functional:!0,render:function(t,e){var i=e.parent;return t("MyActionButton",{props:{icon:i.rotateClockwiseIcon,iconStyle:i.rotateClockwiseIconStyle},on:{click:i.rotateClockwise}})}},MyRotateCounterClockwiseButton:{functional:!0,render:function(t,e){var i=e.parent;return t("MyActionButton",{props:{icon:i.rotateCounterClockwiseIcon,iconStyle:i.rotateCounterClockwiseIconStyle},on:{click:i.rotateCounterClockwise}})}},MyScalingSlider:{functional:!0,render:function(e,i){var n=i.parent,a=n.computedMaxScaling,r=n.computedMinScaling,o=n.disabled,l=n.scaleTo,s=n.scaling;return e(t,{class:"ma-1",props:{disabled:o,hideDetails:!0,max:a,min:r,step:.1,value:s},on:{change:l}})}}},directives:{Claw:e},props:{clearable:s,clearIcon:{type:String,default:"close"},clearIconStyle:Object,debounce:{type:Number,default:0},disabled:c,errorIcon:{type:String,default:"$error"},errorIconStyle:Object,flipHorizontallyIcon:{type:String,default:"arrow right"},flipHorizontallyIconStyle:Object,flipVerticallyIcon:{type:String,default:"arrow up"},flipVerticallyIconStyle:Object,fullHeight:d,fullWidth:u,hideActions:g,imageBackgroundColor:String,imageFormat:{type:String,default:"png"},imageHeight:{type:Number,default:256},imageMaxScaling:{type:Number,default:1},imageMinScaling:{type:String,default:"cover"},imageQuality:{},imageWidth:{type:Number,default:256},name:String,overlayBackgroundColor:{type:String,default:"rgba(0,0,0,0.5)"},overlayBorderColor:{type:String,default:"#fff"},overlayBorderWidth:{type:String,default:"4px"},overlayPadding:{type:String,default:"50px"},readonly:p,rotateClockwiseIcon:{type:String,default:"redo alternate"},rotateClockwiseIconStyle:Object,rotateCounterClockwiseIcon:{type:String,default:"undo alternate"},rotateCounterClockwiseIconStyle:Object,successIcon:{type:String,default:"$success"},successIconStyle:Object,uploadIcon:{type:String,default:"upload"},uploadIconStyle:Object,value:String,backgroundColor:{},maxScaling:{},minScaling:{},rotateCounterclockwiseIcon:{},rotateCounterclockwiseIconStyle:{},scalingSliderColor:{}},data:function(){return{dirtyOriginLeft:.5,dirtyOriginTop:.5,dirtyScaling:0,flippedHorizontally:!1,flippedVertically:!1,imageData:null,internalImageData:null,internalImageHeight:0,internalImageWidth:0,rotated:!1,fileInfo:null}},computed:o,watch:{imageData:function(t){this.$emit("input",t)},updateImageData:function(t,e){clearTimeout(e)},value:{handler:function(t){this.load(t)},immediate:!0}},created:function(){var t=this.$props,e=this.constructor.super.util.warn;Object.entries({imageBackgroundColor:"backgroundColor",imageMaxScaling:"maxScaling",imageMinScaling:"minScaling",rotateCounterClockwiseIcon:"rotateCounterclockwiseIcon",rotateCounterClockwiseIconStyle:"rotateCounterclockwiseIconStyle"}).forEach((function(i){var n=i[0],a=i[1];void 0!==t[a]&&e("["+l+"]: The property '"+a+"' has been renamed to '"+n+"'.")})),["scalingSliderColor"].forEach((function(i){void 0!==t[i]&&e("["+l+"]: The property '"+i+"' has been removed.")}))},methods:{clear:function(){this.internalImageData=null},flipHorizontally:function(){this.rotated?this.flippedVertically=!this.flippedVertically:this.flippedHorizontally=!this.flippedHorizontally,this.dirtyOriginLeft=1-this.dirtyOriginLeft},flipVertically:function(){this.rotated?this.flippedHorizontally=!this.flippedHorizontally:this.flippedVertically=!this.flippedVertically,this.dirtyOriginTop=1-this.dirtyOriginTop},load:function(t){var e=this,i=t.file,n=t.base64;if((this.imageData||n)&&this.imageData!==n){var a=new Image;a.addEventListener("load",(function(t){var i=a.naturalWidth,r=a.naturalHeight;e.internalImageData=i&&r?n:null,e.internalImageWidth=i,e.internalImageHeight=r,e.flippedHorizontally=!1,e.flippedVertically=!1,e.rotated=!1,e.scaling=0,e.dirtyOriginLeft=.5,e.dirtyOriginTop=.5})),i&&this.$emit("file-info",{name:i.name||"",size:i.size||"",type:i.type||"",lastModified:i.lastModified||""}),a.src=n}},onPan:function(t){this.croppingLeft+=t.x-t.previousX,this.croppingTop+=t.y-t.previousY},rotateClockwise:function(){this.rotated?(this.rotated=!1,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically):this.rotated=!0;var t=this.dirtyOriginTop;this.dirtyOriginTop=this.dirtyOriginLeft,this.dirtyOriginLeft=1-t},rotateCounterClockwise:function(){this.rotated?this.rotated=!1:(this.rotated=!0,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically);var t=this.dirtyOriginLeft;this.dirtyOriginLeft=this.dirtyOriginTop,this.dirtyOriginTop=1-t},scaleTo:function(t){this.scaling=t}},render:function(t){return t("div",{style:Object.assign({},{display:["-ms-inline-grid","inline-grid"],gridColumns:"1fr auto",gridRows:"1fr auto",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"},this.fullHeight?{height:"100%"}:{},this.fullWidth?{width:"100%"}:{})},[t("div",{style:{gridColumn:1,gridRow:1,overflow:"hidden",position:"relative"}},[t("div",Object.assign({},{style:Object.assign({},{alignItems:"center",background:"#454545",display:"flex",height:"100%",justifyContent:"center",overflow:"hidden",padding:"calc("+this.overlayPadding+" + "+this.overlayBorderWidth+")",position:"relative",width:"100%",zIndex:0},this.internalImageData||this.readonly?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},this.internalImageData?this.disabled||this.readonly?{}:{directives:[{name:"Claw",arg:"pan",value:this.onPan}]}:{}),[t("div",{style:{boxShadow:"0 0 4000px 4000px "+this.overlayBackgroundColor,maxHeight:"100%",maxWidth:"100%",outline:this.overlayBorderWidth+" solid "+this.overlayBorderColor,pointerEvents:"none"}},[t("div",{style:Object.assign({},{height:this.imageHeight+"px",position:"relative",width:this.imageWidth+"px",zIndex:-1},this.imageBackgroundColor?{backgroundColor:this.imageBackgroundColor}:{})},(this.internalImageData?[t("img",{style:{pointerEvents:"none",position:"absolute",transform:["translate("+this.croppingLeft+"px,"+this.croppingTop+"px)","scale("+this.scaling+")"].concat(this.rotated?["translateX("+this.internalImageHeight+"px)","rotate(90deg)"]:[],this.flippedVertically?["translateY("+this.internalImageHeight+"px)","scaleY(-1)"]:[],this.flippedHorizontally?["translateX("+this.internalImageWidth+"px)","scaleX(-1)"]:[]).join(" "),transformOrigin:"0 0"},attrs:{src:this.internalImageData}})]:[]).concat(this.internalImageData&&this.imageData?[t("input",{attrs:{name:this.name,type:"hidden",value:this.imageData}})]:[]))])])].concat(this.internalImageData||this.readonly?[]:[t("MyFileUpload",{style:{bottom:0,left:0,position:"absolute",right:0,top:0},on:{load:this.load}})])),t("div",{style:Object.assign({},{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center"},this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},(this.clearable?[t("MyClearButton")]:[]).concat(this.hideActions||this.readonly?[]:[t("MyRotateClockwiseButton"),t("MyRotateCounterClockwiseButton"),t("MyFlipHorizontallyButton"),t("MyFlipVerticallyButton")])),t("div",{style:Object.assign({},{gridColumn:1,gridRow:2},this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},this.hideActions||this.readonly?[]:[t("MyScalingSlider")])])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(h.name,h),h}));
